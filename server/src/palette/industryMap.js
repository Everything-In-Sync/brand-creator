const INDUSTRY_LIBRARY = {
  healthcare: {
    paletteTemplates: [
      {
        primary: '#2D7CBF',
        secondary: '#3DB5C4',
        accent: '#F0A35E',
        neutral: '#F4F9FC',
        background: '#FFFFFF',
        nameSeeds: ['Harbor', 'Vital', 'Pulse', 'Serene', 'Guardian']
      },
      {
        primary: '#1F6F8B',
        secondary: '#99C4D3',
        accent: '#F28F3B',
        neutral: '#EEF6F8',
        background: '#FAFEFF',
        nameSeeds: ['Bay', 'Calm', 'Sapphire', 'Care', 'Compass']
      },
      {
        primary: '#207561',
        secondary: '#3DBDA7',
        accent: '#FFC971',
        neutral: '#F4F8F7',
        background: '#FDFEFE',
        nameSeeds: ['Evergreen', 'Balance', 'Renew', 'Pulse', 'Vital']
      }
    ],
    defaultIconStyles: ['rounded', 'outline']
  },
  finance: {
    paletteTemplates: [
      {
        primary: '#1F3C88',
        secondary: '#214151',
        accent: '#DAA520',
        neutral: '#E8ECF1',
        background: '#F7F8FB',
        nameSeeds: ['Ledger', 'Trust', 'Crest', 'Anchor', 'Sovereign']
      },
      {
        primary: '#002B5B',
        secondary: '#495867',
        accent: '#C19A6B',
        neutral: '#E5E9F2',
        background: '#FFFFFF',
        nameSeeds: ['Reserve', 'Summit', 'Capital', 'Foundry', 'Atlas']
      },
      {
        primary: '#153243',
        secondary: '#284B63',
        accent: '#F4A259',
        neutral: '#F2F2F2',
        background: '#FAFBFF',
        nameSeeds: ['Harbor', 'North', 'Monument', 'Standard', 'Reliance']
      }
    ],
    defaultIconStyles: ['sharp', 'outline']
  },
  construction: {
    paletteTemplates: [
      {
        primary: '#C84B31',
        secondary: '#346751',
        accent: '#ECDBBA',
        neutral: '#F5E6CA',
        background: '#F8F1E7',
        nameSeeds: ['Forge', 'Mason', 'Titan', 'Steelworks', 'Anchor']
      },
      {
        primary: '#E8751A',
        secondary: '#1B1A17',
        accent: '#536162',
        neutral: '#F3F4ED',
        background: '#FAF4EC',
        nameSeeds: ['Auric', 'Foundry', 'Structure', 'Horizon', 'Keystone']
      },
      {
        primary: '#DFAF2B',
        secondary: '#2F4858',
        accent: '#FF784F',
        neutral: '#E2E2E2',
        background: '#FFF8ED',
        nameSeeds: ['Summit', 'Framework', 'Strata', 'Ironclad', 'Blueprint']
      }
    ],
    defaultIconStyles: ['geometric', 'sharp']
  },
  technology: {
    paletteTemplates: [
      {
        primary: '#1F51FF',
        secondary: '#23A6D5',
        accent: '#A020F0',
        neutral: '#F1F5FF',
        background: '#FAFBFF',
        nameSeeds: ['Neon', 'Quantum', 'Pulse', 'Vector', 'Circuit']
      },
      {
        primary: '#0B7285',
        secondary: '#15AABF',
        accent: '#E8590C',
        neutral: '#F1F3F5',
        background: '#FFFFFF',
        nameSeeds: ['Sonic', 'Nova', 'Signal', 'Core', 'Flux']
      },
      {
        primary: '#272343',
        secondary: '#3A506B',
        accent: '#FF6B6B',
        neutral: '#F7F9FC',
        background: '#0A0B1E',
        nameSeeds: ['Vertex', 'Cipher', 'Zenith', 'Array', 'Binary']
      }
    ],
    defaultIconStyles: ['geometric', 'outline']
  },
  beauty: {
    paletteTemplates: [
      {
        primary: '#C06C84',
        secondary: '#F67280',
        accent: '#F8B195',
        neutral: '#FFF0F3',
        background: '#FFF8F9',
        nameSeeds: ['Bloom', 'Velvet', 'Luxe', 'Roseate', 'Glow']
      },
      {
        primary: '#7F5A83',
        secondary: '#A188A6',
        accent: '#FFC4EB',
        neutral: '#F6F2F7',
        background: '#FFFFFF',
        nameSeeds: ['Quartz', 'Muse', 'Aura', 'Petal', 'Facet']
      },
      {
        primary: '#8A2BE2',
        secondary: '#DB7093',
        accent: '#FFB6C1',
        neutral: '#F8EAF6',
        background: '#FDFCFF',
        nameSeeds: ['Jewel', 'Serenity', 'Orchid', 'Lustre', 'Opaline']
      }
    ],
    defaultIconStyles: ['rounded', 'handcrafted']
  },
  hospitality: {
    paletteTemplates: [
      {
        primary: '#A85C0C',
        secondary: '#F1C27D',
        accent: '#6A492B',
        neutral: '#F8F1E7',
        background: '#FFF9F3',
        nameSeeds: ['Ember', 'Hearth', 'Welcome', 'Saffron', 'Terrace']
      },
      {
        primary: '#2A9D8F',
        secondary: '#E9C46A',
        accent: '#F4A261',
        neutral: '#F2F6F5',
        background: '#FFFFFF',
        nameSeeds: ['Oasis', 'Mirage', 'Harbor', 'Vista', 'Refuge']
      },
      {
        primary: '#264653',
        secondary: '#2A9D8F',
        accent: '#E76F51',
        neutral: '#FAF3E4',
        background: '#F8FAF9',
        nameSeeds: ['Coastal', 'Retreat', 'Haven', 'Sunset', 'Lagoon']
      }
    ],
    defaultIconStyles: ['rounded', 'outline']
  },
  education: {
    paletteTemplates: [
      {
        primary: '#2A6F97',
        secondary: '#5C9EAD',
        accent: '#FFC300',
        neutral: '#F6F8FB',
        background: '#FFFFFF',
        nameSeeds: ['Scholarly', 'Beacon', 'Mentor', 'Summit', 'Legacy']
      },
      {
        primary: '#1D4E89',
        secondary: '#6DAEDB',
        accent: '#FFB30F',
        neutral: '#F2F5F7',
        background: '#FAFBFF',
        nameSeeds: ['Academy', 'Foundation', 'Aspire', 'Northstar', 'Syllabus']
      },
      {
        primary: '#4C5B5C',
        secondary: '#9DA9A0',
        accent: '#FFC857',
        neutral: '#F8F9FA',
        background: '#FFFFFF',
        nameSeeds: ['Chalkline', 'Lecture', 'Canvas', 'Schola', 'Enlight']
      }
    ],
    defaultIconStyles: ['outline', 'geometric']
  },
  legal: {
    paletteTemplates: [
      {
        primary: '#0B1F3A',
        secondary: '#1F3B73',
        accent: '#8C6A43',
        neutral: '#E8EBF1',
        background: '#F8F9FB',
        nameSeeds: ['Jurist', 'Tribunal', 'Counsel', 'Chambers', 'Monument']
      },
      {
        primary: '#12263A',
        secondary: '#394A59',
        accent: '#B4975A',
        neutral: '#F1F2F7',
        background: '#FFFFFF',
        nameSeeds: ['Pillars', 'Verdict', 'Concord', 'Foundry', 'Regal']
      },
      {
        primary: '#1C2238',
        secondary: '#27304E',
        accent: '#8E4A49',
        neutral: '#E5E7EB',
        background: '#FAFCFF',
        nameSeeds: ['Navy', 'Summit', 'Covenant', 'Barrister', 'Argent']
      }
    ],
    defaultIconStyles: ['sharp', 'geometric']
  },
  restaurant: {
    paletteTemplates: [
      {
        primary: '#D9534F',
        secondary: '#5CB85C',
        accent: '#F0AD4E',
        neutral: '#F7F3E9',
        background: '#FFF8F1',
        nameSeeds: ['Harvest', 'Heirloom', 'Cask', 'Crimson', 'Copper']
      },
      {
        primary: '#A1253C',
        secondary: '#F2784B',
        accent: '#FFD166',
        neutral: '#F4EFE6',
        background: '#FFF5EB',
        nameSeeds: ['Bistro', 'Cellar', 'Terra', 'Flame', 'Saffron']
      },
      {
        primary: '#35524A',
        secondary: '#6E9887',
        accent: '#E1C667',
        neutral: '#F6F3E7',
        background: '#FAFBF7',
        nameSeeds: ['Grove', 'Herb', 'Granary', 'Stone', 'Copper']
      }
    ],
    defaultIconStyles: ['handcrafted', 'rounded']
  },
  nonprofit: {
    paletteTemplates: [
      {
        primary: '#1B4965',
        secondary: '#5FA8D3',
        accent: '#F06543',
        neutral: '#F1F5F8',
        background: '#FAFCFF',
        nameSeeds: ['Impact', 'Beacon', 'Hope', 'Lift', 'Unity']
      },
      {
        primary: '#1D4E89',
        secondary: '#76B39D',
        accent: '#FFC857',
        neutral: '#F0F4F1',
        background: '#FFFFFF',
        nameSeeds: ['Catalyst', 'Bridge', 'Mission', 'Cause', 'Kindred']
      },
      {
        primary: '#355070',
        secondary: '#6D597A',
        accent: '#B56576',
        neutral: '#F6F4F6',
        background: '#FBFAFD',
        nameSeeds: ['Horizon', 'Aurora', 'Anchor', 'Compass', 'Solace']
      }
    ],
    defaultIconStyles: ['rounded', 'outline']
  },
  fitness: {
    paletteTemplates: [
      {
        primary: '#EF233C',
        secondary: '#D90429',
        accent: '#2B2D42',
        neutral: '#EDF2F4',
        background: '#FFFFFF',
        nameSeeds: ['Momentum', 'Pulse', 'Velocity', 'Iron', 'Forge']
      },
      {
        primary: '#1B998B',
        secondary: '#2D3047',
        accent: '#FFFD82',
        neutral: '#F3F6F4',
        background: '#FAFEFF',
        nameSeeds: ['Kinetic', 'Drive', 'Summit', 'Sprint', 'Atlas']
      },
      {
        primary: '#5F0F40',
        secondary: '#9A031E',
        accent: '#FB8B24',
        neutral: '#EFE7E3',
        background: '#F9F6F4',
        nameSeeds: ['Ember', 'Titan', 'Energize', 'Crimson', 'Volt']
      }
    ],
    defaultIconStyles: ['sharp', 'geometric']
  }
};

const INDUSTRY_ALIASES = {
  tech: 'technology',
  software: 'technology',
  it: 'technology',
  beauty: 'beauty',
  salon: 'beauty',
  spa: 'beauty',
  hospitality: 'hospitality',
  hotel: 'hospitality',
  resort: 'hospitality',
  travel: 'hospitality',
  health: 'healthcare',
  medical: 'healthcare',
  clinic: 'healthcare',
  dentist: 'healthcare',
  education: 'education',
  school: 'education',
  university: 'education',
  finance: 'finance',
  banking: 'finance',
  fintech: 'finance',
  construction: 'construction',
  contractor: 'construction',
  architecture: 'construction',
  restaurant: 'restaurant',
  food: 'restaurant',
  cafe: 'restaurant',
  nonprofit: 'nonprofit',
  charity: 'nonprofit',
  foundation: 'nonprofit',
  fitness: 'fitness',
  gym: 'fitness',
  wellness: 'fitness',
  legal: 'legal',
  law: 'legal',
  attorney: 'legal'
};

const INDUSTRY_KEYS = Object.keys(INDUSTRY_LIBRARY);

function levenshtein(a, b) {
  const matrix = Array.from({ length: a.length + 1 }, () => new Array(b.length + 1).fill(0));
  for (let i = 0; i <= a.length; i += 1) matrix[i][0] = i;
  for (let j = 0; j <= b.length; j += 1) matrix[0][j] = j;
  for (let i = 1; i <= a.length; i += 1) {
    for (let j = 1; j <= b.length; j += 1) {
      const cost = a[i - 1] === b[j - 1] ? 0 : 1;
      matrix[i][j] = Math.min(
        matrix[i - 1][j] + 1,
        matrix[i][j - 1] + 1,
        matrix[i - 1][j - 1] + cost
      );
    }
  }
  return matrix[a.length][b.length];
}

export function resolveIndustry(input) {
  if (!input) {
    return 'general';
  }
  const normalized = input.trim().toLowerCase();
  if (INDUSTRY_LIBRARY[normalized]) {
    return normalized;
  }
  if (INDUSTRY_ALIASES[normalized]) {
    return INDUSTRY_ALIASES[normalized];
  }
  const words = normalized.split(/[^a-z]+/g).filter(Boolean);
  for (const word of words) {
    if (INDUSTRY_LIBRARY[word]) {
      return word;
    }
    if (INDUSTRY_ALIASES[word]) {
      return INDUSTRY_ALIASES[word];
    }
  }
  let bestMatch = 'general';
  let bestDistance = Number.POSITIVE_INFINITY;
  for (const key of INDUSTRY_KEYS) {
    const distance = levenshtein(normalized, key);
    if (distance < bestDistance) {
      bestDistance = distance;
      bestMatch = key;
    }
  }
  return bestMatch;
}

const GENERAL_PROFILE = {
  paletteTemplates: [
    {
      primary: '#3366FF',
      secondary: '#2EC4B6',
      accent: '#FFBF69',
      neutral: '#F4F7FB',
      background: '#FFFFFF',
      nameSeeds: ['Standard', 'Clarity', 'Vertex', 'Signal', 'Origin']
    },
    {
      primary: '#2E294E',
      secondary: '#1B998B',
      accent: '#ED217C',
      neutral: '#F2F4F8',
      background: '#FFFFFF',
      nameSeeds: ['Primary', 'Core', 'Momentum', 'Pulse', 'Vector']
    },
    {
      primary: '#264653',
      secondary: '#2A9D8F',
      accent: '#E76F51',
      neutral: '#F1FAEE',
      background: '#FAFBFE',
      nameSeeds: ['Mesa', 'Canyon', 'River', 'Horizon', 'Summit']
    }
  ],
  defaultIconStyles: ['outline', 'geometric']
};

export function getIndustryProfile(industryKey) {
  if (!industryKey || industryKey === 'general') {
    return GENERAL_PROFILE;
  }
  return INDUSTRY_LIBRARY[industryKey] ?? GENERAL_PROFILE;
}

export function listIndustries() {
  return INDUSTRY_KEYS;
}
